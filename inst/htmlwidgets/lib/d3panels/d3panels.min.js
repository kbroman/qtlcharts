var abs,calc_crosstab,chrscales,ci_by_group,colSums,count_groups,d3panels,displayError,expand2vector,forceAsArray,formatAxis,getLeftRight,log10,log2,matrixExtent,matrixMax,matrixMaxAbs,matrixMin,maxdiff,mean_by_group,median,missing2null,pullVarAsArray,reorgLodData,rowSums,sd_by_group,selectGroupColors,sumArray,transpose,unique;d3panels={version:"0.6.3"};formatAxis=function(d,extra_digits){var ndig;if(extra_digits==null){extra_digits=0}d=d[1]-d[0];ndig=Math.floor(log10(d));if(ndig>0){ndig=0}ndig=Math.abs(ndig)+extra_digits;return d3.format("."+ndig+"f")};unique=function(x){var k,len,output,results,v;output={};for(k=0,len=x.length;k<len;k++){v=x[k];if(v){output[v]=v}}results=[];for(v in output){results.push(output[v])}return results};pullVarAsArray=function(data,variable){var i,results;results=[];for(i in data){results.push(data[i][variable])}return results};reorgLodData=function(data,lodvarname){var chr,i,j,k,l,len,len1,len2,lodcolumn,lodval,marker,o,pos,ref,ref1,ref2;if(lodvarname==null){lodvarname=null}data.posByChr={};data.lodByChr={};ref=data.chrnames;for(i=k=0,len=ref.length;k<len;i=++k){chr=ref[i];data.posByChr[chr]=[];data.lodByChr[chr]=[];ref1=data.pos;for(j=l=0,len1=ref1.length;l<len1;j=++l){pos=ref1[j];if(data.chr[j]===chr){data.posByChr[chr].push(pos);if(!Array.isArray(data.lodnames)){data.lodnames=[data.lodnames]}lodval=function(){var len2,o,ref2,results;ref2=data.lodnames;results=[];for(o=0,len2=ref2.length;o<len2;o++){lodcolumn=ref2[o];results.push(data[lodcolumn][j])}return results}();data.lodByChr[chr].push(lodval)}}}if(lodvarname!=null){data.markers=[];ref2=data.markernames;for(i=o=0,len2=ref2.length;o<len2;i=++o){marker=ref2[i];if(marker!==""){data.markers.push({name:marker,chr:data.chr[i],pos:data.pos[i],lod:data[lodvarname][i]})}}}return data};chrscales=function(data,width,chrGap,leftMargin,pad4heatmap){var L,chr,chrEnd,chrLength,chrStart,cur,d,i,k,l,len,len1,maxd,ref,ref1,rng,totalChrLength,w;chrStart=[];chrEnd=[];chrLength=[];totalChrLength=0;maxd=0;ref=data.chrnames;for(k=0,len=ref.length;k<len;k++){chr=ref[k];d=maxdiff(data.posByChr[chr]);if(d>maxd){maxd=d}rng=d3.extent(data.posByChr[chr]);chrStart.push(rng[0]);chrEnd.push(rng[1]);L=rng[1]-rng[0];chrLength.push(L);totalChrLength+=L}if(pad4heatmap){data.recwidth=maxd;chrStart=chrStart.map(function(x){return x-maxd/2});chrEnd=chrEnd.map(function(x){return x+maxd/2});chrLength=chrLength.map(function(x){return x+maxd});totalChrLength+=chrLength.length*maxd}data.chrStart=[];data.chrEnd=[];cur=leftMargin;if(!pad4heatmap){cur+=chrGap/2}data.xscale={};ref1=data.chrnames;for(i=l=0,len1=ref1.length;l<len1;i=++l){chr=ref1[i];data.chrStart.push(cur);w=Math.round((width-chrGap*(data.chrnames.length-pad4heatmap))/totalChrLength*chrLength[i]);data.chrEnd.push(cur+w);cur=data.chrEnd[i]+chrGap;data.xscale[chr]=d3.scale.linear().domain([chrStart[i],chrEnd[i]]).range([data.chrStart[i],data.chrEnd[i]])}return data};selectGroupColors=function(ngroup,palette){if(ngroup===0){return[]}if(palette==="dark"){if(ngroup===1){return["slateblue"]}if(ngroup===2){return["MediumVioletRed","slateblue"]}if(ngroup===3){return["MediumVioletRed","MediumSeaGreen","slateblue"]}if(ngroup<=9){return colorbrewer.Set1[ngroup]}return d3.scale.category20().range().slice(0,ngroup)}else{if(ngroup===1){return["#bebebe"]}if(ngroup===2){return["lightpink","lightblue"]}if(ngroup<=9){return colorbrewer.Pastel1[ngroup]}return["#8fc7f4","#fed7f8","#ffbf8e","#fffbb8","#8ce08c","#d8ffca","#f68788","#ffd8d6","#d4a7fd","#f5f0f5","#cc968b","#f4dcd4","#f3b7f2","#f7f6f2","#bfbfbf","#f7f7f7","#fcfd82","#fbfbcd","#87feff","#defaf5"].slice(0,ngroup)}};expand2vector=function(input,n){var i;if(input==null){return input}if(Array.isArray(input)&&input.length>=n){return input}if(!Array.isArray(input)){input=[input]}if(input.length>1&&n>1){input=function(){var results;results=[];for(i in d3.range(n)){results.push(input[i%input.length])}return results}()}if(input.length===1&&n>1){input=function(){var results;results=[];for(i in d3.range(n)){results.push(input[0])}return results}()}return input};median=function(x){var n,xv;if(x==null){return null}x=function(){var k,len,results;results=[];for(k=0,len=x.length;k<len;k++){xv=x[k];if(xv!=null){results.push(xv)}}return results}();n=x.length;if(!(n>0)){return null}x.sort(function(a,b){return a-b});if(n%2===1){return x[(n-1)/2]}return(x[n/2]+x[n/2-1])/2};getLeftRight=function(x){var i,k,l,len,n,o,ref,ref1,result,v,xdif;n=x.length;x.sort(function(a,b){return a-b});xdif=[];result={};for(k=0,len=x.length;k<len;k++){v=x[k];result[v]={}}for(i=l=1,ref=n;1<=ref?l<ref:l>ref;i=1<=ref?++l:--l){xdif.push(x[i]-x[i-1]);result[x[i]].left=x[i-1]}for(i=o=0,ref1=n-1;0<=ref1?o<ref1:o>ref1;i=0<=ref1?++o:--o){result[x[i]].right=x[i+1]}xdif=median(xdif);result.mediandiff=xdif;result[x[0]].left=x[0]-xdif;result[x[n-1]].right=x[n-1]+xdif;result.extent=[x[0]-xdif/2,x[n-1]+xdif/2];return result};maxdiff=function(x){var d,i,k,ref,result;if(x.length<2){return null}result=x[1]-x[0];if(x.length<3){return result}for(i=k=2,ref=x.length;2<=ref?k<ref:k>ref;i=2<=ref?++k:--k){d=x[i]-x[i-1];if(d>result){result=d}}return result};matrixMin=function(mat){var i,j,result;result=mat[0][0];for(i in mat){for(j in mat[i]){if(!(result!=null)||result>mat[i][j]&&mat[i][j]!=null){result=mat[i][j]}}}return result};matrixMax=function(mat){var i,j,result;result=mat[0][0];for(i in mat){for(j in mat[i]){if(!(result!=null)||result<mat[i][j]&&mat[i][j]!=null){result=mat[i][j]}}}return result};matrixMaxAbs=function(mat){var i,j,result;result=Math.abs(mat[0][0]);for(i in mat){for(j in mat[i]){if(!(result!=null)||result<Math.abs(mat[i][j])&&mat[i][j]!=null){result=Math.abs(mat[i][j])}}}return result};matrixExtent=function(mat){return[matrixMin(mat),matrixMax(mat)]};d3.selection.prototype.moveToFront=function(){return this.each(function(){return this.parentNode.appendChild(this)})};d3.selection.prototype.moveToBack=function(){return this.each(function(){var firstChild;firstChild=this.parentNode.firstchild;if(firstChild){return this.parentNode.insertBefore(this,firstChild)}})};forceAsArray=function(x){if(x==null){return x}if(Array.isArray(x)){return x}return[x]};missing2null=function(vec,missingvalues){if(missingvalues==null){missingvalues=["NA",""]}return vec.map(function(value){if(missingvalues.indexOf(value)>-1){return null}else{return value}})};displayError=function(message,divid){var div;if(divid==null){divid=null}div="div.error";if(divid!=null){div+="#"+divid}if(d3.select(div).empty()){d3.select("body").insert("div",":first-child").attr("class","error")}return d3.select(div).append("p").text(message)};sumArray=function(vec){var x;vec=function(){var k,len,results;results=[];for(k=0,len=vec.length;k<len;k++){x=vec[k];if(x!=null){results.push(x)}}return results}();if(!(vec.length>0)){return null}return vec.reduce(function(a,b){return a*1+b*1})};calc_crosstab=function(data){var col,cs,i,k,l,ncol,nrow,ref,ref1,result,row,rs;nrow=data.ycat.length;ncol=data.xcat.length;result=function(){var k,ref,results;results=[];for(row=k=0,ref=nrow;0<=ref?k<=ref:k>=ref;row=0<=ref?++k:--k){results.push(function(){var l,ref1,results1;results1=[];for(col=l=0,ref1=ncol;0<=ref1?l<=ref1:l>=ref1;col=0<=ref1?++l:--l){results1.push(0)}return results1}())}return results}();for(i in data.x){result[data.y[i]][data.x[i]]+=1}rs=rowSums(result);cs=colSums(result);for(i=k=0,ref=ncol;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k){result[nrow][i]=cs[i]}for(i=l=0,ref1=nrow;0<=ref1?l<ref1:l>ref1;i=0<=ref1?++l:--l){result[i][ncol]=rs[i]}result[nrow][ncol]=sumArray(rs);return result};rowSums=function(mat){var k,len,results,x;results=[];for(k=0,len=mat.length;k<len;k++){x=mat[k];results.push(sumArray(x))}return results};transpose=function(mat){var i,j,k,ref,results;results=[];for(j=k=0,ref=mat[0].length;0<=ref?k<ref:k>ref;j=0<=ref?++k:--k){results.push(function(){var l,ref1,results1;results1=[];for(i=l=0,ref1=mat.length;0<=ref1?l<ref1:l>ref1;i=0<=ref1?++l:--l){results1.push(mat[i][j])}return results1}())}return results};colSums=function(mat){return rowSums(transpose(mat))};log2=function(x){if(x==null){return x}return Math.log(x)/Math.log(2)};log10=function(x){if(x==null){return x}return Math.log(x)/Math.log(10)};abs=function(x){if(x==null){return x}return Math.abs(x)};mean_by_group=function(g,y){var i,means,n;means={};n={};for(i in g){if(n[g[i]]!=null){if(y[i]!=null){means[g[i]]+=y[i]}if(y[i]!=null){n[g[i]]+=1}}else{if(y[i]!=null){means[g[i]]=y[i]}if(y[i]!=null){n[g[i]]=1}}}for(i in means){means[i]/=n[i]}return means};sd_by_group=function(g,y){var dev,i,means,n,sds;means=mean_by_group(g,y);sds={};n={};for(i in g){dev=y[i]-means[g[i]];if(n[g[i]]!=null){if(y[i]!=null){sds[g[i]]+=dev*dev}if(y[i]!=null){n[g[i]]+=1}}else{if(y[i]!=null){sds[g[i]]=dev*dev}if(y[i]!=null){n[g[i]]=1}}}for(i in sds){sds[i]=n[i]<2?null:Math.sqrt(sds[i]/(n[i]-1))}return sds};count_groups=function(g,y){var i,n;n={};for(i in g){if(n[g[i]]!=null){if(y[i]!=null){n[g[i]]+=1}}else{if(y[i]!=null){n[g[i]]=1}}}return n};ci_by_group=function(g,y,m){var ci,dev,i,means,n,sds;if(m==null){m=2}means=mean_by_group(g,y);sds={};n={};for(i in g){dev=y[i]-means[g[i]];if(n[g[i]]!=null){if(y[i]!=null){sds[g[i]]+=dev*dev}if(y[i]!=null){n[g[i]]+=1}}else{if(y[i]!=null){sds[g[i]]=dev*dev}if(y[i]!=null){n[g[i]]=1}}}for(i in sds){sds[i]=n[i]<2?null:Math.sqrt(sds[i]/(n[i]-1))}ci={};for(i in means){ci[i]={mean:means[i],low:n[i]>0?means[i]-m*sds[i]/Math.sqrt(n[i]):means[i],high:n[i]>0?means[i]+m*sds[i]/Math.sqrt(n[i]):means[i]}}return ci};var chrheatmap;chrheatmap=function(){var axispos,bordercolor,cellSelect,celltip,chart,chrGap,colors,hover,margin,nullcolor,oneAtTop,pixelPerCell,rectcolor,rotate_ylab,svg,tipclass,title,titlepos,xlab,ylab,zlim,zscale,zthresh;pixelPerCell=3;chrGap=4;margin={left:60,top:40,right:40,bottom:40};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;rectcolor="#e6e6e6";nullcolor="#e6e6e6";bordercolor="black";colors=["slateblue","white","crimson"];title="";xlab="";ylab="";rotate_ylab=null;zlim=null;zthresh=null;zscale=d3.scale.linear();oneAtTop=false;hover=true;cellSelect=null;svg=null;celltip=null;tipclass="";chart=function(selection){return selection.each(function(data){var cell,cells,chrborders,cur,g,gEnter,height,i,j,k,l,len,nchr,nm,nx,ny,ref,ref1,titlegrp,totmar,val,width,x,xCellStart,xChrBorder,xaxis,yCellStart,yChrBorder,yaxis,zmax,zmin;ny=data.z.length;nx=function(){var k,len,ref,results;ref=data.z;results=[];for(k=0,len=ref.length;k<len;k++){x=ref[k];results.push(x.length)}return results}();for(i in nx){if(nx[i]!==ny){displayError("Row "+(i+1)+" of data.z is not the right length: "+nx[i]+" != "+ny)}}nchr=data.nmar.length;totmar=sumArray(data.nmar);if(totmar!==ny){displayError("sum(data.nmar) ["+sumArray(data.nmar)+"] != data.z.length ["+data.z.length+"]")}if(data.chrnames.length!==nchr){displayError.log("data.nmar.length ["+data.nmar.length+"] != data.chrnames.length ["+data.chrnames.length+"]")}if(data.labels.length!==totmar){displayError("data.labels.length ["+data.labels.length+"] != sum(data.nmar) ["+sum(data.nmar)+"]")}if(chrGap<1){displayError("chrGap should be >= 2 (was "+chrGap+")");chrGap=2}xChrBorder=[0];xCellStart=[];cur=chrGap/2;ref=data.nmar;for(k=0,len=ref.length;k<len;k++){nm=ref[k];for(j=l=0,ref1=nm;0<=ref1?l<ref1:l>ref1;j=0<=ref1?++l:--l){xCellStart.push(cur+1);cur=cur+pixelPerCell}xChrBorder.push(cur+1+chrGap/2);cur=cur+chrGap}width=cur-chrGap/2;height=width;if(oneAtTop){yChrBorder=function(){var len1,m,results;results=[];for(m=0,len1=xChrBorder.length;m<len1;m++){val=xChrBorder[m];results.push(val)}return results}();yCellStart=function(){var len1,m,results;results=[];for(m=0,len1=xCellStart.length;m<len1;m++){val=xCellStart[m];results.push(val)}return results}()}else{yChrBorder=function(){var len1,m,results;results=[];for(m=0,len1=xChrBorder.length;m<len1;m++){val=xChrBorder[m];results.push(height-val+1)}return results}();yCellStart=function(){var len1,m,results;results=[];for(m=0,len1=xCellStart.length;m<len1;m++){val=xCellStart[m];results.push(height-val-pixelPerCell)}return results}()}data.cells=[];for(i in data.z){for(j in data.z[i]){data.cells.push({i:i,j:j,z:data.z[i][j],x:xCellStart[i]+margin.left,y:yCellStart[j]+margin.top})}}data.allz=function(){var len1,m,ref2,results;ref2=data.cells;results=[];for(m=0,len1=ref2.length;m<len1;m++){cell=ref2[m];results.push(cell.z)}return results}();zmin=d3.min(data.allz);zmax=d3.max(data.allz);if(-zmin>zmax){zmax=-zmin}zlim=zlim!=null?zlim:[-zmax,0,zmax];if(zlim.length!==colors.length){displayError("zlim.length ("+zlim.length+") != colors.length ("+colors.length+")")}zscale.domain(zlim).range(colors);zthresh=zthresh!=null?zthresh:zmin-1;data.cells=function(){var len1,m,ref2,results;ref2=data.cells;results=[];for(m=0,len1=ref2.length;m<len1;m++){cell=ref2[m];if(cell.z>=zthresh||cell.z<=-zthresh){results.push(cell)}}return results}();svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",rectcolor).attr("stroke",null).attr("stroke-width","0");chrborders=g.append("g").attr("id","chrBorders");chrborders.selectAll("empty").data(xChrBorder).enter().append("line").attr("x1",function(d){return d+margin.left}).attr("x2",function(d){return d+margin.left}).attr("y1",margin.top).attr("y2",margin.top+height).attr("stroke",bordercolor).attr("stroke-width","1");chrborders.selectAll("empty").data(yChrBorder).enter().append("line").attr("y1",function(d){return d+margin.top}).attr("y2",function(d){return d+margin.top}).attr("x1",margin.left).attr("x2",margin.left+width).attr("stroke",bordercolor).attr("stroke-width","1");titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);xaxis.selectAll("empty").data(data.chrnames).enter().append("text").attr("x",function(d,i){return margin.left+(xChrBorder[i]+xChrBorder[i+1])/2}).attr("y",oneAtTop?margin.top-2*axispos.xlabel:margin.top+height+axispos.xlabel).text(function(d){return d}).style("dominant-baseline",oneAtTop?"middle":"hanging");rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");yaxis.selectAll("empty").data(data.chrnames).enter().append("text").attr("y",function(d,i){return margin.top+(yChrBorder[i]+yChrBorder[i+1])/2}).attr("x",margin.left-axispos.ylabel).text(function(d){return d});celltip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){return data.labels[d.i]+", "+data.labels[d.j]+" &rarr; "+formatAxis(data.allz)(d.z)}).direction("e").offset([0,10]);svg.call(celltip);cells=g.append("g").attr("id","cells");cellSelect=cells.selectAll("empty").data(data.cells).enter().append("rect").attr("x",function(d){return d.x}).attr("y",function(d){return d.y}).attr("width",pixelPerCell).attr("height",pixelPerCell).attr("class",function(d,i){return"cell"+i}).attr("fill",function(d){if(d.z!=null){return zscale(d.z)}else{return nullcolor}}).attr("stroke","none").attr("stroke-width","1").on("mouseover.paneltip",function(d){d3.select(this).attr("stroke","black");if(hover){return celltip.show(d)}}).on("mouseout.paneltip",function(){d3.select(this).attr("stroke","none");if(hover){return celltip.hide()}});return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.pixelPerCell=function(value){if(!arguments.length){return pixelPerCell}pixelPerCell=value;return chart};chart.chrGap=function(value){if(!arguments.length){return chrGap}chrGap=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.nullcolor=function(value){if(!arguments.length){return nullcolor}nullcolor=value;return chart};chart.bordercolor=function(value){if(!arguments.length){return bordercolor}bordercolor=value;return chart};chart.colors=function(value){if(!arguments.length){return colors}colors=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.zthresh=function(value){if(!arguments.length){return zthresh}zthresh=value;return chart};chart.zlim=function(value){if(!arguments.length){return zlim}zlim=value;return chart};chart.oneAtTop=function(value){if(!arguments.length){return oneAtTop}oneAtTop=value;return chart};chart.hover=function(value){if(!arguments.length){return hover}hover=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.zscale=function(){return zscale};chart.cellSelect=function(){return cellSelect};chart.remove=function(){svg.remove();celltip.destroy();return null};return chart};var cichart;cichart=function(){var axispos,chart,height,margin,nyticks,rectcolor,rotate_ylab,segcolor,segstrokewidth,segwidth,svg,tip,tipclass,title,titlepos,vertsegcolor,width,xcatlabels,xlab,xscale,ylab,ylim,yscale,yticks;width=400;height=500;margin={left:60,top:40,right:40,bottom:40,inner:5};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;xcatlabels=null;segwidth=null;ylim=null;nyticks=5;yticks=null;rectcolor="#e6e6e6";segcolor="slateblue";segstrokewidth="3";vertsegcolor="slateblue";title="";xlab="Group";ylab="Response";rotate_ylab=null;xscale=d3.scale.ordinal();yscale=d3.scale.linear();svg=null;tip=null;tipclass="";chart=function(selection){return selection.each(function(data){var categories,g,gEnter,high,low,means,segments,titlegrp,xaxis,xrange,yaxis,yrange,ys;means=data.means;low=data.low;high=data.high;categories=data.categories;if(means.length!==low.length){displayError("means.length ["+means.length+"] != low.length ["+low.length+"]")}if(means.length!==high.length){displayError("means.length ["+means.length+"] != high.length ["+high.length+"]")}if(means.length!==categories.length){displayError("means.length ["+means.length+"] != categories.length ["+categories.length+"]")}xcatlabels=xcatlabels!=null?xcatlabels:categories;if(xcatlabels.length!==categories.length){displayError("xcatlabels.length ["+xcatlabels.length+"] != categories.length ["+categories.length+"]")}ylim=ylim!=null?ylim:[d3.min(low),d3.max(high)];svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);segcolor=expand2vector(forceAsArray(segcolor),means.length);vertsegcolor=expand2vector(forceAsArray(vertsegcolor),means.length);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",rectcolor).attr("stroke","none");xrange=[margin.left+margin.inner,margin.left+width-margin.inner];xscale.domain(categories).rangePoints(xrange,1);segwidth=segwidth!=null?segwidth:(xrange[1]-xrange[0])/categories.length*.2;yrange=[margin.top+height-margin.inner,margin.top+margin.inner];yscale.domain(ylim).range(yrange);ys=d3.scale.linear().domain(ylim).range(yrange);yticks=yticks!=null?yticks:ys.ticks(nyticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(categories).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("class","x axis grid");xaxis.selectAll("empty").data(categories).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d,i){return xcatlabels[i]});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("class","y axis grid");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");tip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d,i){var f,index;index=i%means.length;f=formatAxis([low[index],means[index]],1);return f(means[index])+" ("+f(low[index])+" - "+f(high[index])+")"}).direction("e").offset([0,10]);svg.call(tip);segments=g.append("g").attr("id","segments");segments.selectAll("empty").data(low).enter().append("line").attr("x1",function(d,i){return xscale(categories[i])}).attr("x2",function(d,i){return xscale(categories[i])}).attr("y1",function(d){return yscale(d)}).attr("y2",function(d,i){return yscale(high[i])}).attr("fill","none").attr("stroke",function(d,i){return vertsegcolor[i]}).attr("stroke-width",segstrokewidth);segments.selectAll("empty").data(means.concat(low,high)).enter().append("line").attr("x1",function(d,i){var x;x=xscale(categories[i%means.length]);if(i<means.length){return x-segwidth/2}return x-segwidth/3}).attr("x2",function(d,i){var x;x=xscale(categories[i%means.length]);if(i<means.length){return x+segwidth/2}return x+segwidth/3}).attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("fill","none").attr("stroke",function(d,i){return segcolor[i%means.length]}).attr("stroke-width",segstrokewidth).on("mouseover.paneltip",tip.show).on("mouseout.paneltip",tip.hide);return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.xcatlabels=function(value){if(!arguments.length){return xcatlabels}xcatlabels=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.segcolor=function(value){if(!arguments.length){return segcolor}segcolor=value;return chart};chart.segstrokewidth=function(value){if(!arguments.length){return segstrokewidth}segstrokewidth=value;return chart};chart.segwidth=function(value){if(!arguments.length){return segwidth}segwidth=value;return chart};chart.vertsegcolor=function(value){if(!arguments.length){return vertsegcolor}vertsegcolor=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.remove=function(){svg.remove();tip.destroy();return null};return chart};var crosstab;crosstab=function(){var bordercolor,cellHeight,cellPad,cellWidth,chart,fontsize,hilitcolor,margin,rectcolor,svg,title,titlepos;cellHeight=30;cellWidth=80;cellPad=20;margin={left:60,top:80,right:40,bottom:20};titlepos=50;title="";fontsize=cellHeight*.7;rectcolor="#e6e6e6";hilitcolor="#e9cfec";bordercolor="black";svg=null;chart=function(selection){return selection.each(function(data){var borders,cell,cells,collab,colrect,denom,g,gEnter,height,i,j,k,l,m,n,ncol,nrow,o,rect,ref,ref1,ref2,ref3,ref4,ref5,results,results1,rowlab,rowrect,tab,titles,values,width,xscale,yscale;n=data.x.length;if(data.y.length!==n){displayError("data.x.length ["+data.x.length+"] != data.y.length ["+data.y.length+"]")}ncol=data.xcat.length;if(d3.max(data.x)>=ncol||d3.min(data.x)<0){displayError("data.x should be in range 0-"+(ncol-1)+" [was "+d3.min(data.x)+" - "+d3.max(data.x)+"]")}nrow=data.ycat.length;if(d3.max(data.y)>=nrow||d3.min(data.y)<0){displayError("data.y should be in range 0-"+(nrow-1)+" [was "+d3.min(data.y)+" - "+d3.max(data.y)+"]")}tab=calc_crosstab(data);data.xlabel=(ref=data!=null?data.xlabel:void 0)!=null?ref:"";data.ylabel=(ref1=data!=null?data.ylabel:void 0)!=null?ref1:"";cells=[];for(i=k=0,ref2=nrow;0<=ref2?k<=ref2:k>=ref2;i=0<=ref2?++k:--k){for(j=l=0,ref3=ncol;0<=ref3?l<=ref3:l>=ref3;j=0<=ref3?++l:--l){cell={value:tab[i][j],row:i,col:j,shaded:false,rowpercent:"",colpercent:""};if(i<nrow-1&&(j<ncol-1||j===ncol)){cell.shaded=true}if(j<ncol-1&&(i<nrow-1||i===nrow)){cell.shaded=true}if(i<nrow-1){denom=tab[nrow][j]-tab[nrow-1][j];cell.colpercent=denom>0?Math.round(100*tab[i][j]/denom)+"%":"—"}else if(i===nrow-1){denom=tab[nrow][j];cell.colpercent=denom>0?"("+Math.round(100*tab[i][j]/denom)+"%)":"—"}else{cell.colpercent=cell.value}if(j<ncol-1){denom=tab[i][ncol]-tab[i][ncol-1];cell.rowpercent=denom>0?Math.round(100*tab[i][j]/denom)+"%":"—"}else if(j===ncol-1){denom=tab[i][ncol];cell.rowpercent=denom>0?"("+Math.round(100*tab[i][j]/denom)+"%)":"—"}else{cell.rowpercent=cell.value}cells.push(cell)}}width=margin.left+margin.right+(ncol+2)*cellWidth;height=margin.top+margin.bottom+(nrow+2)*cellHeight;xscale=d3.scale.ordinal().domain(function(){results=[];for(var m=0,ref4=ncol+1;0<=ref4?m<=ref4:m>=ref4;0<=ref4?m++:m--){results.push(m)}return results}.apply(this)).rangeBands([margin.left,width-margin.right],0,0);yscale=d3.scale.ordinal().domain(function(){results1=[];for(var o=0,ref5=nrow+1;0<=ref5?o<=ref5:o>=ref5;0<=ref5?o++:o--){results1.push(o)}return results1}.apply(this)).rangeBands([margin.top,height-margin.bottom],0,0);svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");rect=g.append("g").attr("id","value_rect");rect.selectAll("empty").data(cells).enter().append("rect").attr("x",function(d){return xscale(d.col+1)}).attr("y",function(d){return yscale(d.row+1)}).attr("width",cellWidth).attr("height",cellHeight).attr("fill",function(d){if(d.shaded){return rectcolor}else{return"none"}}).attr("stroke",function(d){if(d.shaded){return rectcolor}else{return"none"}}).attr("stroke-width",0).style("pointer-events","none");values=g.append("g").attr("id","values");values.selectAll("empty").data(cells).enter().append("text").attr("x",function(d){return xscale(d.col+1)+cellWidth-cellPad}).attr("y",function(d){return yscale(d.row+1)+cellHeight/2}).text(function(d){return d.value}).attr("class",function(d){return"crosstab row"+d.row+" col"+d.col}).style("font-size",fontsize).style("pointer-events","none");colrect=g.append("g").attr("id","colrect");colrect.selectAll("empty").data(data.xcat.concat("Total")).enter().append("rect").attr("x",function(d,i){return xscale(i+1)}).attr("y",yscale(0)).attr("width",cellWidth).attr("height",cellHeight).attr("fill","white").attr("stroke","white").on("mouseover",function(d,i){d3.select(this).attr("fill",hilitcolor).attr("stroke",hilitcolor);return values.selectAll(".col"+i).text(function(d){return d.colpercent})}).on("mouseout",function(d,i){d3.select(this).attr("fill","white").attr("stroke","white");return values.selectAll("text.col"+i).text(function(d){return d.value})});collab=g.append("g").attr("id","collab");collab.selectAll("empty").data(data.xcat.concat("Total")).enter().append("text").attr("x",function(d,i){return xscale(i+1)+cellWidth-cellPad}).attr("y",yscale(0)+cellHeight/2).text(function(d){return d}).attr("class","crosstab").style("font-size",fontsize).style("pointer-events","none");rowrect=g.append("g").attr("id","rowrect");rowrect.selectAll("empty").data(data.ycat.concat("Total")).enter().append("rect").attr("x",xscale(0)).attr("y",function(d,i){return yscale(i+1)}).attr("width",cellWidth).attr("height",cellHeight).attr("fill","white").attr("stroke","white").on("mouseover",function(d,i){d3.select(this).attr("fill",hilitcolor).attr("stroke",hilitcolor);return values.selectAll(".row"+i).text(function(d){return d.rowpercent})}).on("mouseout",function(d,i){d3.select(this).attr("fill","white").attr("stroke","white");return values.selectAll(".row"+i).text(function(d){return d.value})});rowlab=g.append("g").attr("id","rowlab");rowlab.selectAll("empty").data(data.ycat.concat("Total")).enter().append("text").attr("x",xscale(0)+cellWidth-cellPad).attr("y",function(d,i){return yscale(i+1)+cellHeight/2}).text(function(d){return d}).attr("class","crosstab").style("font-size",fontsize).style("pointer-events","none");borders=g.append("g").attr("id","borders");borders.append("rect").attr("x",xscale(1)).attr("y",yscale(1)).attr("width",cellWidth*ncol).attr("height",cellHeight*nrow).attr("fill","none").attr("stroke",bordercolor).attr("stroke-width",2).style("pointer-events","none");borders.append("rect").attr("x",xscale(ncol+1)).attr("y",yscale(nrow+1)).attr("width",cellWidth).attr("height",cellHeight).attr("fill","none").attr("stroke",bordercolor).attr("stroke-width",2).style("pointer-events","none");titles=g.append("g").attr("id","titles");titles.append("text").attr("class","crosstabtitle").attr("x",margin.left+(ncol+1)*cellWidth/2).attr("y",margin.top-cellHeight/2).text(data.xlabel).style("font-size",fontsize).style("font-weight","bold");titles.append("text").attr("class","crosstab").attr("x",xscale(0)+cellWidth-cellPad).attr("y",yscale(0)+cellHeight/2).text(data.ylabel).style("font-size",fontsize).style("font-weight","bold");return titles.append("text").attr("class","crosstabtitle").attr("x",margin.left+(width-margin.left-margin.right)/2).attr("y",margin.top-titlepos).text(title).style("font-size",fontsize)})};chart.cellHeight=function(value){if(!arguments.length){return cellHeight}cellHeight=value;return chart};chart.cellWidth=function(value){if(!arguments.length){return cellWidth}cellWidth=value;return chart};chart.cellPad=function(value){if(!arguments.length){
return cellPad}cellPad=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.hilitcolor=function(value){if(!arguments.length){return hilitcolor}hilitcolor=value;return chart};chart.bordercolor=function(value){if(!arguments.length){return bordercolor}bordercolor=value;return chart};chart.fontsize=function(value){if(!arguments.length){return fontsize}fontsize=value;return chart};chart.remove=function(){svg.remove();return null};return chart};var curvechart;curvechart=function(){var axispos,chart,commonX,curvesSelect,height,indtip,margin,nxticks,nyticks,rectcolor,rotate_ylab,strokecolor,strokecolorhilit,strokewidth,strokewidthhilit,svg,tipclass,title,titlepos,width,xlab,xlim,xscale,xticks,ylab,ylim,yscale,yticks;width=800;height=500;margin={left:60,top:40,right:40,bottom:40,inner:5};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;xlim=null;ylim=null;nxticks=5;xticks=null;nyticks=5;yticks=null;rectcolor="#e6e6e6";strokecolor=null;strokecolorhilit=null;strokewidth=2;strokewidthhilit=2;title="";xlab="X";ylab="Y";rotate_ylab=null;yscale=d3.scale.linear();xscale=d3.scale.linear();curvesSelect=null;commonX=true;svg=null;indtip=null;tipclass="";chart=function(selection){return selection.each(function(data){var curve,curves,g,gEnter,group,i,indID,ind_data,j,k,l,lastpoint,len,ngroup,points,pointsg,ref,ref1,ref2,ref3,results,titlegrp,tmp,v,xaxis,xrange,xs,yaxis,yrange,ys;indID=(ref=data!=null?data.indID:void 0)!=null?ref:null;indID=indID!=null?indID:function(){results=[];for(var k=1,ref1=data.data.length;1<=ref1?k<=ref1:k>=ref1;1<=ref1?k++:k--){results.push(k)}return results}.apply(this);group=(ref2=data!=null?data.group:void 0)!=null?ref2:function(){var results1;results1=[];for(i in data.data){results1.push(1)}return results1}();ngroup=d3.max(group);group=function(){var l,len,results1;results1=[];for(l=0,len=group.length;l<len;l++){g=group[l];results1.push(g-1)}return results1}();if(sumArray(function(){var l,len,results1;results1=[];for(l=0,len=group.length;l<len;l++){g=group[l];results1.push(g<0||g>ngroup-1)}return results1}())>0){displayError("group values out of range");console.log("groups:");console.log(g)}strokecolor=strokecolor!=null?strokecolor:selectGroupColors(ngroup,"pastel");strokecolor=expand2vector(strokecolor,ngroup);strokecolorhilit=strokecolorhilit!=null?strokecolorhilit:selectGroupColors(ngroup,"dark");strokecolorhilit=expand2vector(strokecolorhilit,ngroup);if(commonX){data=function(){var results1;results1=[];for(i in data.data){results1.push({x:data.x,y:data.data[i]})}return results1}()}else{data=data.data}if(data.length!==group.length){displayError("data.length ("+data.length+") != group.length ("+group.length+")")}if(data.length!==indID.length){displayError("data.length ("+data.length+") != indID.length ("+indID.length+")")}if(sumArray(function(){var l,len,results1;results1=[];for(l=0,len=data.length;l<len;l++){ind_data=data[l];results1.push(ind_data.x.length!==ind_data.y.length)}return results1}())>0){displayError("At least one curve with x.length != y.length")}xlim=xlim!=null?xlim:matrixExtent(pullVarAsArray(data,"x"));ylim=ylim!=null?ylim:matrixExtent(pullVarAsArray(data,"y"));for(i in data){tmp=data[i];data[i]=[];for(j in tmp.x){if(!(tmp.x[j]==null||tmp.y[j]==null)){data[i].push({x:tmp.x[j],y:tmp.y[j]})}}}svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",rectcolor).attr("stroke","none");xrange=[margin.left+margin.inner,margin.left+width-margin.inner];yrange=[margin.top+height-margin.inner,margin.top+margin.inner];xscale.domain(xlim).range(xrange);yscale.domain(ylim).range(yrange);xs=d3.scale.linear().domain(xlim).range(xrange);ys=d3.scale.linear().domain(ylim).range(yrange);yticks=yticks!=null?yticks:ys.ticks(nyticks);xticks=xticks!=null?xticks:xs.ticks(nxticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(xticks).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("fill","none").attr("stroke","white").attr("stroke-width",1).style("pointer-events","none");xaxis.selectAll("empty").data(xticks).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d){return formatAxis(xticks)(d)});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("fill","none").attr("stroke","white").attr("stroke-width",1).style("pointer-events","none");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");indtip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){return indID[d]}).direction("e").offset([0,10]);svg.call(indtip);curve=d3.svg.line().x(function(d){return xscale(d.x)}).y(function(d){return yscale(d.y)});curves=g.append("g").attr("id","curves");curvesSelect=curves.selectAll("empty").data(d3.range(data.length)).enter().append("path").datum(function(d){return data[d]}).attr("d",curve).attr("class",function(d,i){return"path"+i}).attr("fill","none").attr("stroke",function(d,i){return strokecolor[group[i]]}).attr("stroke-width",strokewidth).on("mouseover.panel",function(d,i){var circle;d3.select(this).attr("stroke",strokecolorhilit[group[i]]).moveToFront();circle=d3.select("circle#hiddenpoint"+i);return indtip.show(i,circle.node())}).on("mouseout.panel",function(d,i){d3.select(this).attr("stroke",strokecolor[group[i]]).moveToBack();return indtip.hide()});lastpoint=function(){var results1;results1=[];for(i in data){results1.push({x:null,y:null})}return results1}();for(i in data){ref3=data[i];for(l=0,len=ref3.length;l<len;l++){v=ref3[l];if(v.x!=null&&v.y!=null){lastpoint[i]=v}}}pointsg=g.append("g").attr("id","invisiblepoints");points=pointsg.selectAll("empty").data(lastpoint).enter().append("circle").attr("id",function(d,i){return"hiddenpoint"+i}).attr("cx",function(d){return xscale(d.x)}).attr("cy",function(d){return yscale(d.y)}).attr("r",1).attr("opacity",0);return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.xlim=function(value){if(!arguments.length){return xlim}xlim=value;return chart};chart.nxticks=function(value){if(!arguments.length){return nxticks}nxticks=value;return chart};chart.xticks=function(value){if(!arguments.length){return xticks}xticks=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.strokecolor=function(value){if(!arguments.length){return strokecolor}strokecolor=value;return chart};chart.strokecolorhilit=function(value){if(!arguments.length){return strokecolorhilit}strokecolorhilit=value;return chart};chart.strokewidth=function(value){if(!arguments.length){return strokewidth}strokewidth=value;return chart};chart.strokewidthhilit=function(value){if(!arguments.length){return strokewidthhilit}strokewidthhilit=value;return chart};chart.commonX=function(value){if(!arguments.length){return commonX}commonX=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.curvesSelect=function(){return curvesSelect};chart.remove=function(){svg.remove();indtip.destroy();return null};return chart};var dotchart,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};dotchart=function(){var axispos,chart,dataByInd,height,indtip,margin,nyticks,pointcolor,pointsSelect,pointsize,pointstroke,rectcolor,rotate_ylab,svg,tipclass,title,titlepos,width,xcategories,xcatlabels,xjitter,xlab,xscale,xvar,yNA,ylab,ylim,yscale,yticks,yvar;width=400;height=500;margin={left:60,top:40,right:40,bottom:40,inner:5};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;xcategories=null;xcatlabels=null;xjitter=null;yNA={handle:true,force:false,width:15,gap:10};ylim=null;nyticks=5;yticks=null;rectcolor="#e6e6e6";pointcolor="slateblue";pointstroke="black";pointsize=3;title="";xlab="Group";ylab="Response";rotate_ylab=null;xscale=d3.scale.ordinal();yscale=d3.scale.linear();xvar=0;yvar=1;pointsSelect=null;dataByInd=true;svg=null;indtip=null;tipclass="";chart=function(selection){return selection.each(function(data){var g,gEnter,indID,j,na_value,panelheight,points,ref,ref1,results,titlegrp,v,w,x,xaxis,xrange,xv,y,yaxis,yrange,ys;if(dataByInd){x=data.map(function(d){return d[xvar]});y=data.map(function(d){return d[yvar]})}else{x=data[xvar];y=data[yvar]}indID=(ref=data!=null?data.indID:void 0)!=null?ref:null;indID=indID!=null?indID:function(){results=[];for(var j=1,ref1=x.length;1<=ref1?j<=ref1:j>=ref1;1<=ref1?j++:j--){results.push(j)}return results}.apply(this);if(x.length!==y.length){displayError("length(x) ["+x.length+"] != length(y) ["+y.length+"]")}if(indID.length!==x.length){displayError("length(indID) ["+indID.length+"] != length(x) ["+x.length+"]")}if(y.every(function(v){return v!=null&&!yNA.force})){yNA.handle=false}if(yNA.handle){panelheight=height-(yNA.width+yNA.gap)}else{panelheight=height}xcategories=xcategories!=null?xcategories:unique(x);xcatlabels=xcatlabels!=null?xcatlabels:xcategories;if(xcatlabels.length!==xcategories.length){displayError("xcatlabels.length ["+xcatlabels.length+"] != xcategories.length ["+xcategories.length+"]")}if(sumArray(function(){var k,len,results1;results1=[];for(k=0,len=x.length;k<len;k++){xv=x[k];results1.push(xv!=null&&!(indexOf.call(xcategories,xv)>=0))}return results1}())>0){displayError("Some x values not in xcategories");console.log("xcategories:");console.log(xcategories);console.log("x:");console.log(x)}ylim=ylim!=null?ylim:d3.extent(y);na_value=d3.min(y)-100;svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",panelheight).attr("width",width).attr("fill",rectcolor).attr("stroke","none");if(yNA.handle){g.append("rect").attr("x",margin.left).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",width).attr("fill",rectcolor).attr("stroke","none")}xrange=[margin.left+margin.inner,margin.left+width-margin.inner];xscale.domain(xcategories).rangePoints(xrange,1);if(xjitter===null){w=(xrange[1]-xrange[0])/xcategories.length;xjitter=function(){var k,len,ref2,results1;ref2=d3.range(x.length);results1=[];for(k=0,len=ref2.length;k<len;k++){v=ref2[k];results1.push((Math.random()-.5)*w*.2)}return results1}()}else{if(typeof xjitter==="number"){xjitter=[xjitter]}if(xjitter.length===1){xjitter=function(){var k,len,ref2,results1;ref2=d3.range(x.length);results1=[];for(k=0,len=ref2.length;k<len;k++){v=ref2[k];results1.push(xjitter[0])}return results1}()}}if(xjitter.length!==x.length){displayError("xjitter.length ["+xjitter.length+"] != x.length ["+x.length+"]")}yrange=[margin.top+panelheight-margin.inner,margin.top+margin.inner];yscale.domain(ylim).range(yrange);ys=d3.scale.linear().domain(ylim).range(yrange);if(yNA.handle){yscale.domain([na_value].concat(ylim)).range([height+margin.top-yNA.width/2].concat(yrange));y=y.map(function(e){if(e!=null){return e}else{return na_value}})}yticks=yticks!=null?yticks:ys.ticks(nyticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(xcategories).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("class","x axis grid");xaxis.selectAll("empty").data(xcategories).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d,i){return xcatlabels[i]});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("class","y axis grid");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");if(yNA.handle){yaxis.append("text").attr("x",margin.left-axispos.ylabel).attr("y",margin.top+height-yNA.width/2).text("N/A")}indtip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d,i){return indID[i]}).direction("e").offset([0,10]);svg.call(indtip);points=g.append("g").attr("id","points");pointsSelect=points.selectAll("empty").data(x).enter().append("circle").attr("cx",function(d,i){return xscale(x[i])+xjitter[i]}).attr("cy",function(d,i){return yscale(y[i])}).attr("class",function(d,i){return"pt"+i}).attr("r",pointsize).attr("fill",pointcolor).attr("stroke",pointstroke).attr("stroke-width","1").attr("opacity",function(d,i){var ref2;if((y[i]!=null||yNA.handle)&&x[i]!=null&&(ref2=x[i],indexOf.call(xcategories,ref2)>=0)){return 1}return 0}).on("mouseover.paneltip",indtip.show).on("mouseout.paneltip",indtip.hide);g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",panelheight).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none");if(yNA.handle){return g.append("rect").attr("x",margin.left).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")}})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.xcategories=function(value){if(!arguments.length){return xcategories}xcategories=value;return chart};chart.xcatlabels=function(value){if(!arguments.length){return xcatlabels}xcatlabels=value;return chart};chart.xjitter=function(value){if(!arguments.length){return xjitter}xjitter=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.pointcolor=function(value){if(!arguments.length){return pointcolor}pointcolor=value;return chart};chart.pointsize=function(value){if(!arguments.length){return pointsize}pointsize=value;return chart};chart.pointstroke=function(value){if(!arguments.length){return pointstroke}pointstroke=value;return chart};chart.dataByInd=function(value){if(!arguments.length){return dataByInd}dataByInd=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.xvar=function(value){if(!arguments.length){return xvar}xvar=value;return chart};chart.yvar=function(value){if(!arguments.length){return yvar}yvar=value;return chart};chart.yNA=function(value){if(!arguments.length){return yNA}yNA=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.pointsSelect=function(){return pointsSelect};chart.remove=function(){svg.remove();indtip.destroy();return null};return chart};var heatmap;heatmap=function(){var axispos,cellSelect,celltip,chart,colors,dataByCell,height,margin,nullcolor,nxticks,nyticks,rectcolor,rotate_ylab,svg,tipclass,title,titlepos,width,xlab,xlim,xscale,xticks,ylab,ylim,yscale,yticks,zlim,zscale,zthresh;width=400;height=500;margin={left:60,top:40,right:40,bottom:40};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;xlim=null;nxticks=5;xticks=null;ylim=null;nyticks=5;yticks=null;rectcolor="#e6e6e6";nullcolor="#e6e6e6";colors=["slateblue","white","crimson"];title="";xlab="X";ylab="Y";rotate_ylab=null;zlim=null;zthresh=null;xscale=d3.scale.linear();yscale=d3.scale.linear();zscale=d3.scale.linear();cellSelect=null;dataByCell=false;svg=null;celltip=null;tipclass="";chart=function(selection){return selection.each(function(data){var cell,cells,g,gEnter,i,j,k,len,nx,ny,ref,titlegrp,xLR,xaxis,xrange,yLR,yaxis,yrange,zmax,zmin;if(dataByCell){data.x=function(){var k,len,ref,results;ref=data.cells;results=[];for(k=0,len=ref.length;k<len;k++){cell=ref[k];results.push(cell.x)}return results}();data.y=function(){var k,len,ref,results;ref=data.cells;results=[];for(k=0,len=ref.length;k<len;k++){cell=ref[k];results.push(cell.y)}return results}();data.allz=function(){var k,len,ref,results;ref=data.cells;results=[];for(k=0,len=ref.length;k<len;k++){cell=ref[k];results.push(cell.z)}return results}()}else{nx=data.x.length;ny=data.y.length;if(nx!==data.z.length){displayError("data.x.length ("+data.x.length+") != data.z.length ("+data.z.length+")")}if(ny!==data.z[0].length){displayError("data.y.length ("+data.y.length+") != data.z[0].length ("+data.z[0].length+")")}data.cells=[];for(i in data.z){for(j in data.z[i]){data.cells.push({x:data.x[i],y:data.y[j],z:data.z[i][j],i:i,j:j})}}data.allz=function(){var k,len,ref,results;ref=data.cells;results=[];for(k=0,len=ref.length;k<len;k++){cell=ref[k];results.push(cell.z)}return results}()}data.x.sort(function(a,b){return a-b});data.y.sort(function(a,b){return a-b});xLR=getLeftRight(data.x);yLR=getLeftRight(data.y);xlim=xlim!=null?xlim:xLR.extent;ylim=ylim!=null?ylim:yLR.extent;zmin=d3.min(data.allz);zmax=d3.max(data.allz);if(-zmin>zmax){zmax=-zmin}zlim=zlim!=null?zlim:[-zmax,0,zmax];if(zlim.length!==colors.length){displayError("zlim.length ("+zlim.length+") != colors.length ("+colors.length+")")}zscale.domain(zlim).range(colors);zthresh=zthresh!=null?zthresh:zmin-1;data.cells=function(){var k,len,ref,results;ref=data.cells;results=[];for(k=0,len=ref.length;k<len;k++){cell=ref[k];if(cell.z>=zthresh||cell.z<=-zthresh){results.push(cell)}}return results}();ref=data.cells;for(k=0,len=ref.length;k<len;k++){cell=ref[k];cell.recLeft=(xLR[cell.x].left+cell.x)/2;cell.recRight=(xLR[cell.x].right+cell.x)/2;cell.recTop=(yLR[cell.y].right+cell.y)/2;cell.recBottom=(yLR[cell.y].left+cell.y)/2}svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",rectcolor).attr("stroke","none");xrange=[margin.left,margin.left+width];xscale.domain(xlim).range(xrange);yrange=[margin.top+height,margin.top];yscale.domain(ylim).range(yrange);xticks=xticks!=null?xticks:xscale.ticks(nxticks);yticks=yticks!=null?yticks:yscale.ticks(nyticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(xticks).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("class","y axis grid");xaxis.selectAll("empty").data(xticks).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d){return formatAxis(xticks)(d)});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("class","y axis grid");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");celltip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){var x,y,z;x=formatAxis(data.x)(d.x);y=formatAxis(data.y)(d.y);z=formatAxis(data.allz)(d.z);return"("+x+", "+y+") &rarr; "+z}).direction("e").offset([0,10]);svg.call(celltip);cells=g.append("g").attr("id","cells");cellSelect=cells.selectAll("empty").data(data.cells).enter().append("rect").attr("x",function(d){return xscale(d.recLeft)}).attr("y",function(d){return yscale(d.recTop)}).attr("width",function(d){return xscale(d.recRight)-xscale(d.recLeft)}).attr("height",function(d){return yscale(d.recBottom)-yscale(d.recTop)}).attr("class",function(d,i){return"cell"+i}).attr("fill",function(d){if(d.z!=null){return zscale(d.z)}else{return nullcolor}}).attr("stroke","none").attr("stroke-width","1").on("mouseover.paneltip",function(d){d3.select(this).attr("stroke","black");return celltip.show(d)}).on("mouseout.paneltip",function(){d3.select(this).attr("stroke","none");return celltip.hide()});return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.xlim=function(value){if(!arguments.length){return xlim}xlim=value;return chart};chart.nxticks=function(value){if(!arguments.length){return nxticks}nxticks=value;return chart};chart.xticks=function(value){if(!arguments.length){return xticks}xticks=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.nullcolor=function(value){if(!arguments.length){return nullcolor}nullcolor=value;return chart};chart.colors=function(value){if(!arguments.length){return colors}colors=value;return chart};chart.dataByCell=function(value){if(!arguments.length){return dataByCell}dataByCell=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.zthresh=function(value){if(!arguments.length){return zthresh}zthresh=value;return chart};chart.zlim=function(value){if(!arguments.length){return zlim}zlim=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.xscale=function(){return xscale};chart.yscale=function(){return yscale};chart.zscale=function(){return zscale};chart.cellSelect=function(){return cellSelect};chart.remove=function(){svg.remove();celltip.destroy();return null};return chart};var lodchart;lodchart=function(){var axispos,chart,chrGap,chrSelect,darkrect,height,lightrect,linecolor,linewidth,lodcurve,lodvarname,margin,markerSelect,markertip,nyticks,pad4heatmap,pointcolor,pointsAtMarkers,pointsize,pointstroke,rotate_ylab,svg,tipclass,title,titlepos,width,xlab,xscale,ylab,ylim,yscale,yticks;width=800;height=500;margin={left:60,top:40,right:40,bottom:40,inner:5};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;ylim=null;nyticks=5;yticks=null;chrGap=8;darkrect="#c8c8c8";lightrect="#e6e6e6";linecolor="darkslateblue";linewidth=2;pointcolor="#E9CFEC";pointsize=0;pointstroke="black";title="";xlab="Chromosome";ylab="LOD score";rotate_ylab=null;yscale=d3.scale.linear();xscale=null;pad4heatmap=false;lodcurve=null;lodvarname=null;markerSelect=null;chrSelect=null;pointsAtMarkers=true;svg=null;markertip=null;tipclass="";chart=function(selection){return selection.each(function(data){var bigpointsize,chr,curves,g,gEnter,hiddenpoints,j,len,lodvarnum,markerpoints,ref,ref1,titlegrp,x,xaxis,yaxis;data.chrnames=forceAsArray(data.chrnames);data.lodnames=forceAsArray(data.lodnames);lodvarname=lodvarname!=null?lodvarname:data.lodnames[0];data[lodvarname]=function(){var j,len,ref,results;ref=data[lodvarname];results=[];for(j=0,len=ref.length;j<len;j++){x=ref[j];results.push(abs(x))}return results}();ylim=ylim!=null?ylim:[0,d3.max(data[lodvarname])];lodvarnum=data.lodnames.indexOf(lodvarname);if(data.chr.length!==data.pos.length){displayError("chr.length ("+data.chr.length+") != pos.length ("+data.pos.length+")")}if(data.chr.length!==data.markernames.length){displayError("chr.length ("+data.chr.length+") != markernames.length ("+data.markernames.length+")")}svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",darkrect).attr("stroke","none");margin.inner=(ref=margin!=null?margin.inner:void 0)!=null?ref:0;yscale.domain(ylim).range([height+margin.top,margin.top+margin.inner]);yticks=yticks!=null?yticks:yscale.ticks(nyticks);data=reorgLodData(data,lodvarname);data=chrscales(data,width,chrGap,margin.left,pad4heatmap);xscale=data.xscale;chrSelect=g.append("g").attr("class","chrRect").selectAll("empty").data(data.chrnames).enter().append("rect").attr("id",function(d){return"chrrect"+d}).attr("x",function(d,i){if(i===0&&pad4heatmap){return data.chrStart[i]}return data.chrStart[i]-chrGap/2}).attr("width",function(d,i){if((i===0||i+1===data.chrnames.length)&&pad4heatmap){return data.chrEnd[i]-data.chrStart[i]+chrGap/2}return data.chrEnd[i]-data.chrStart[i]+chrGap}).attr("y",margin.top).attr("height",height).attr("fill",function(d,i){if(i%2){return darkrect}return lightrect}).attr("stroke","none");xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(data.chrnames).enter().append("text").text(function(d){return d}).attr("x",function(d,i){return(data.chrStart[i]+data.chrEnd[i])/2}).attr("y",margin.top+height+axispos.xlabel);xaxis.append("text").attr("class","title").attr("y",margin.top+height+axispos.xtitle).attr("x",margin.left+width/2).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("fill","none").attr("stroke","white").attr("stroke-width",1).style("pointer-events","none");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");lodcurve=function(chr,lodcolumn){return d3.svg.line().x(function(d){return xscale[chr](d)}).y(function(d,i){return yscale(data.lodByChr[chr][i][lodcolumn])})};curves=g.append("g").attr("id","curves");ref1=data.chrnames;for(j=0,len=ref1.length;j<len;j++){chr=ref1[j];curves.append("path").datum(data.posByChr[chr]).attr("d",lodcurve(chr,lodvarnum)).attr("stroke",linecolor).attr("fill","none").attr("stroke-width",linewidth).style("pointer-events","none");
}if(pointsize>0){markerpoints=g.append("g").attr("id","markerpoints_visible");markerpoints.selectAll("empty").data(data.markers).enter().append("circle").attr("cx",function(d){return xscale[d.chr](d.pos)}).attr("cy",function(d){return yscale(d.lod)}).attr("r",function(d){if(d.lod!=null){return pointsize}else{return null}}).attr("fill",pointcolor).attr("stroke",pointstroke).attr("pointer-events","hidden")}if(pointsAtMarkers){hiddenpoints=g.append("g").attr("id","markerpoints_hidden");markertip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){return[d.name," LOD = "+d3.format(".2f")(d.lod)]}).direction("e").offset([0,10]);svg.call(markertip);bigpointsize=d3.max([2*pointsize,3]);markerSelect=hiddenpoints.selectAll("empty").data(data.markers).enter().append("circle").attr("cx",function(d){return xscale[d.chr](d.pos)}).attr("cy",function(d){return yscale(d.lod)}).attr("id",function(d){return d.name}).attr("r",function(d){if(d.lod!=null){return bigpointsize}else{return null}}).attr("opacity",0).attr("fill",pointcolor).attr("stroke",pointstroke).attr("stroke-width","1").on("mouseover.paneltip",function(d){d3.select(this).attr("opacity",1);return markertip.show(d)}).on("mouseout.paneltip",function(){return d3.select(this).attr("opacity",0).call(markertip.hide)})}titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",function(){if(pad4heatmap){return data.chrEnd.slice(-1)[0]-margin.left}return data.chrEnd.slice(-1)[0]-margin.left+chrGap/2}).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.chrGap=function(value){if(!arguments.length){return chrGap}chrGap=value;return chart};chart.darkrect=function(value){if(!arguments.length){return darkrect}darkrect=value;return chart};chart.lightrect=function(value){if(!arguments.length){return lightrect}lightrect=value;return chart};chart.linecolor=function(value){if(!arguments.length){return linecolor}linecolor=value;return chart};chart.linewidth=function(value){if(!arguments.length){return linewidth}linewidth=value;return chart};chart.pointcolor=function(value){if(!arguments.length){return pointcolor}pointcolor=value;return chart};chart.pointsize=function(value){if(!arguments.length){return pointsize}pointsize=value;return chart};chart.pointstroke=function(value){if(!arguments.length){return pointstroke}pointstroke=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.lodvarname=function(value){if(!arguments.length){return lodvarname}lodvarname=value;return chart};chart.pad4heatmap=function(value){if(!arguments.length){return pad4heatmap}pad4heatmap=value;return chart};chart.pointsAtMarkers=function(value){if(!arguments.length){return pointsAtMarkers}pointsAtMarkers=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.lodcurve=function(){return lodcurve};chart.markerSelect=function(){return markerSelect};chart.chrSelect=function(){return chrSelect};chart.remove=function(){svg.remove();markertip.destroy();return null};return chart};var lodheatmap;lodheatmap=function(){var axispos,cellSelect,celltip,chart,chrGap,colors,height,lod_labels,margin,nullcolor,nyticks,quantScale,rectcolor,rotate_ylab,svg,tipclass,title,titlepos,width,xlab,xscale,ylab,yscale,yticks,zlim,zscale,zthresh;width=1200;height=600;margin={left:60,top:40,right:40,bottom:40};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};chrGap=8;titlepos=20;rectcolor="#e6e6e6";nullcolor="#e6e6e6";colors=["slateblue","white","crimson"];title="";xlab="Chromosome";ylab="";rotate_ylab=null;zlim=null;zthresh=null;quantScale=null;lod_labels=null;nyticks=5;yticks=null;xscale=d3.scale.linear();yscale=d3.scale.linear();zscale=d3.scale.linear();cellSelect=null;svg=null;celltip=null;tipclass="";chart=function(selection){return selection.each(function(data){var cells,chr,extent,g,gEnter,i,j,k,l,len,len1,len2,len3,len4,lod,lodcol,m,n,nlod,o,pos,quant_y_scale,rectHeight,ref,ref1,ref2,ref3,ref4,titlegrp,xLR,xaxis,yaxis,zmax,zmin;data=reorgLodData(data);data=chrscales(data,width,chrGap,margin.left,true);xscale=data.xscale;nlod=data.lodnames.length;yscale.domain([-.5,nlod-.5]).range([margin.top+height,margin.top]);rectHeight=yscale(0)-yscale(1);xLR={};ref=data.chrnames;for(k=0,len=ref.length;k<len;k++){chr=ref[k];xLR[chr]=getLeftRight(data.posByChr[chr])}zmin=0;zmax=0;ref1=data.lodnames;for(l=0,len1=ref1.length;l<len1;l++){lodcol=ref1[l];extent=d3.extent(data[lodcol]);if(extent[0]<zmin){zmin=extent[0]}if(extent[1]>zmax){zmax=extent[1]}}if(-zmin>zmax){zmax=-zmin}zlim=zlim!=null?zlim:[-zmax,0,zmax];if(zlim.length!==colors.length){displayError("zlim.length ("+zlim.length+") != colors.length ("+colors.length+")")}zscale.domain(zlim).range(colors);zthresh=zthresh!=null?zthresh:zmin-1;data.cells=[];ref2=data.chrnames;for(m=0,len2=ref2.length;m<len2;m++){chr=ref2[m];ref3=data.posByChr[chr];for(i=n=0,len3=ref3.length;n<len3;i=++n){pos=ref3[i];ref4=data.lodByChr[chr][i];for(j=o=0,len4=ref4.length;o<len4;j=++o){lod=ref4[j];if(lod>=zthresh||lod<=-zthresh){data.cells.push({z:lod,left:(xscale[chr](pos)+xscale[chr](xLR[chr][pos].left))/2,right:(xscale[chr](pos)+xscale[chr](xLR[chr][pos].right))/2,lodindex:j,chr:chr,pos:pos})}}}}lod_labels=lod_labels!=null?lod_labels:data.lodnames;svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("g").attr("id","boxes").selectAll("empty").data(data.chrnames).enter().append("rect").attr("id",function(d){return"box"+d}).attr("x",function(d,i){return data.chrStart[i]}).attr("y",function(d){return margin.top}).attr("height",height).attr("width",function(d,i){return data.chrEnd[i]-data.chrStart[i]}).attr("fill",rectcolor).attr("stroke","none");titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(data.chrnames).enter().append("text").attr("x",function(d,i){return(data.chrStart[i]+data.chrEnd[i])/2}).attr("y",margin.top+height+axispos.xlabel).text(function(d){return d});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");if(quantScale!=null){quant_y_scale=d3.scale.linear().domain([quantScale[0],quantScale[quantScale.length-1]]).range([margin.top+height-rectHeight/2,margin.top+rectHeight/2]);yticks=yticks!=null?yticks:quant_y_scale.ticks(nyticks);yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return quant_y_scale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)})}else{yaxis.selectAll("empty").data(lod_labels).enter().append("text").attr("id",function(d,i){return"yaxis"+i}).attr("y",function(d,i){return yscale(i)}).attr("x",margin.left-axispos.ylabel).text(function(d){return d}).attr("opacity",0)}celltip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){var p,z;z=d3.format(".2f")(Math.abs(d.z));p=d3.format(".1f")(d.pos);return d.chr+"@"+p+", "+lod_labels[d.lodindex]+" &rarr; "+z}).direction("e").offset([0,10]);svg.call(celltip);cells=g.append("g").attr("id","cells");cellSelect=cells.selectAll("empty").data(data.cells).enter().append("rect").attr("x",function(d){return d.left}).attr("y",function(d){return yscale(d.lodindex)-rectHeight/2}).attr("width",function(d){return d.right-d.left}).attr("height",rectHeight).attr("class",function(d,i){return"cell"+i}).attr("fill",function(d){if(d.z!=null){return zscale(d.z)}else{return nullcolor}}).attr("stroke","none").attr("stroke-width","1").on("mouseover.paneltip",function(d){yaxis.select("text#yaxis"+d.lodindex).attr("opacity",1);d3.select(this).attr("stroke","black");return celltip.show(d)}).on("mouseout.paneltip",function(d){yaxis.select("text#yaxis"+d.lodindex).attr("opacity",0);d3.select(this).attr("stroke","none");return celltip.hide()});return g.append("g").attr("id","boxes").selectAll("empty").data(data.chrnames).enter().append("rect").attr("id",function(d){return"box"+d}).attr("x",function(d,i){return data.chrStart[i]}).attr("y",function(d){return margin.top}).attr("height",height).attr("width",function(d,i){return data.chrEnd[i]-data.chrStart[i]}).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.nullcolor=function(value){if(!arguments.length){return nullcolor}nullcolor=value;return chart};chart.colors=function(value){if(!arguments.length){return colors}colors=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.zthresh=function(value){if(!arguments.length){return zthresh}zthresh=value;return chart};chart.zlim=function(value){if(!arguments.length){return zlim}zlim=value;return chart};chart.chrGap=function(value){if(!arguments.length){return chrGap}chrGap=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.quantScale=function(value){if(!arguments.length){return quantScale}quantScale=value;return chart};chart.lod_labels=function(value){if(!arguments.length){return lod_labels}lod_labels=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.xscale=function(){return xscale};chart.yscale=function(){return yscale};chart.zscale=function(){return zscale};chart.cellSelect=function(){return cellSelect};chart.remove=function(){svg.remove();celltip.destroy();return null};return chart};var mapchart;mapchart=function(){var axispos,chart,height,linecolor,linecolorhilit,linewidth,margin,markerSelect,martip,nyticks,rectcolor,rotate_ylab,svg,tickwidth,tipclass,title,titlepos,width,xlab,xscale,ylab,ylim,yscale,yticks;width=1e3;height=600;margin={left:60,top:40,right:40,bottom:40,inner:10};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;ylim=null;nyticks=5;yticks=null;tickwidth=10;rectcolor="#e6e6e6";linecolor="slateblue";linecolorhilit="Orchid";linewidth=3;title="";xlab="Chromosome";ylab="Position (cM)";rotate_ylab=null;xscale=d3.scale.ordinal();yscale=d3.scale.linear();markerSelect=null;svg=null;martip=null;tipclass="";chart=function(selection){return selection.each(function(data){var chr,g,gEnter,i,j,len,len1,mar,marker,markernames,markerpos,markers,pos,ref,ref1,titlegrp,xaxis,xrange,yaxis,yextentByChr,ymax,ymin,yrange;if(sumArray(function(){var i,len,ref,results;ref=data.chr;results=[];for(i=0,len=ref.length;i<len;i++){chr=ref[i];results.push(!(data.map[chr]!=null))}return results}())>0){displayError("Some chr in data.chr not in data.map")}if(sumArray(function(){var results;results=[];for(chr in data.map){results.push(!(data.chr!=null))}return results}())>0){displayError("Some chr in data.map not in data.chr")}yextentByChr={};ref=data.chr;for(i=0,len=ref.length;i<len;i++){chr=ref[i];pos=function(){var results;results=[];for(marker in data.map[chr]){results.push(data.map[chr][marker])}return results}();yextentByChr[chr]=d3.extent(pos)}ymin=function(){var j,len1,ref1,results;ref1=data.chr;results=[];for(j=0,len1=ref1.length;j<len1;j++){chr=ref1[j];results.push(yextentByChr[chr][0])}return results}();ymax=function(){var j,len1,ref1,results;ref1=data.chr;results=[];for(j=0,len1=ref1.length;j<len1;j++){chr=ref1[j];results.push(yextentByChr[chr][1])}return results}();ylim=ylim!=null?ylim:d3.extent(ymin.concat(ymax));svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill",rectcolor).attr("stroke","none");xrange=[margin.left+margin.inner,margin.left+width-margin.inner];xscale.domain(data.chr).rangePoints(xrange,1);yrange=[margin.top+margin.inner,margin.top+height-margin.inner];yscale.domain(ylim).range(yrange);yticks=yticks!=null?yticks:yscale.ticks(nyticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(data.chr).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("class","x axis grid");xaxis.selectAll("empty").data(data.chr).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d){return d});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("class","y axis grid");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");g.append("g").attr("id","chromosomes").selectAll("empty").data(data.chr).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",function(d){return yscale(yextentByChr[d][0])}).attr("y2",function(d){return yscale(yextentByChr[d][1])}).attr("fill","none").attr("stroke",linecolor).attr("stroke-width",linewidth).style("pointer-events","none");martip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d){pos=d3.format(".1f")(markerpos[d].pos);return d+" ("+pos+")"}).direction("e").offset([0,10]);svg.call(martip);markerpos={};ref1=data.chr;for(j=0,len1=ref1.length;j<len1;j++){chr=ref1[j];for(marker in data.map[chr]){markerpos[marker]={chr:chr,pos:data.map[chr][marker]}}}markernames=function(){var results;results=[];for(mar in markerpos){results.push(mar)}return results}();markers=g.append("g").attr("id","points");markerSelect=markers.selectAll("empty").data(markernames).enter().append("line").attr("x1",function(d){return xscale(markerpos[d].chr)-tickwidth}).attr("x2",function(d){return xscale(markerpos[d].chr)+tickwidth}).attr("y1",function(d){return yscale(markerpos[d].pos)}).attr("y2",function(d){return yscale(markerpos[d].pos)}).attr("id",function(d){return d}).attr("fill","none").attr("stroke",linecolor).attr("stroke-width",linewidth).on("mouseover.paneltip",function(d){d3.select(this).attr("stroke",linecolorhilit);return martip.show(d)}).on("mouseout.paneltip",function(){d3.select(this).attr("stroke",linecolor);return martip.hide()});return g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",height).attr("width",width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.tickwidth=function(value){if(!arguments.length){return tickwidth}tickwidth=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.linecolor=function(value){if(!arguments.length){return linecolor}linecolor=value;return chart};chart.linecolorhilit=function(value){if(!arguments.length){return linecolorhilit}linecolorhilit=value;return chart};chart.linewidth=function(value){if(!arguments.length){return linewidth}linewidth=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.markerSelect=function(){return markerSelect};chart.remove=function(){svg.remove();martip.destroy();return null};return chart};var scatterplot;scatterplot=function(){var axispos,chart,dataByInd,height,indtip,margin,nxticks,nyticks,pointcolor,pointsSelect,pointsize,pointstroke,rectcolor,rotate_ylab,svg,tipclass,title,titlepos,width,xNA,xlab,xlim,xscale,xticks,xvar,yNA,ylab,ylim,yscale,yticks,yvar;width=800;height=500;margin={left:60,top:40,right:40,bottom:40,inner:5};axispos={xtitle:25,ytitle:30,xlabel:5,ylabel:5};titlepos=20;xNA={handle:true,force:false,width:15,gap:10};yNA={handle:true,force:false,width:15,gap:10};xlim=null;ylim=null;nxticks=5;xticks=null;nyticks=5;yticks=null;rectcolor="#e6e6e6";pointcolor=null;pointstroke="black";pointsize=3;title="";xlab="X";ylab="Y";rotate_ylab=null;yscale=d3.scale.linear();xscale=d3.scale.linear();xvar=0;yvar=1;pointsSelect=null;dataByInd=true;svg=null;indtip=null;tipclass="";chart=function(selection){return selection.each(function(data){var g,gEnter,group,i,indID,j,na_value,ngroup,panelheight,paneloffset,panelwidth,points,ref,ref1,ref2,results,titlegrp,x,xaxis,xrange,xs,y,yaxis,yrange,ys;if(dataByInd){x=data.data.map(function(d){return d[xvar]});y=data.data.map(function(d){return d[yvar]})}else{x=data.data[xvar];y=data.data[yvar]}if(x.length!==y.length){displayError("x.length ("+x.length+") != y.length ("+y.length+")")}x=missing2null(x,["NA",""]);y=missing2null(y,["NA",""]);indID=(ref=data!=null?data.indID:void 0)!=null?ref:null;indID=indID!=null?indID:function(){results=[];for(var j=1,ref1=x.length;1<=ref1?j<=ref1:j>=ref1;1<=ref1?j++:j--){results.push(j)}return results}.apply(this);if(indID.length!==x.length){displayError("indID.length ("+indID.length+") != x.length ("+x.length+")")}group=(ref2=data!=null?data.group:void 0)!=null?ref2:function(){var k,len,results1;results1=[];for(k=0,len=x.length;k<len;k++){i=x[k];results1.push(1)}return results1}();ngroup=d3.max(group);group=function(){var k,len,results1;results1=[];for(k=0,len=group.length;k<len;k++){g=group[k];results1.push(g-1)}return results1}();if(sumArray(function(){var k,len,results1;results1=[];for(k=0,len=group.length;k<len;k++){g=group[k];results1.push(g<0||g>ngroup-1)}return results1}())>0){displayError("group values out of range");console.log("ngroup: "+ngroup);console.log("g:");console.log(g)}if(group.length!==x.length){displayError("group.length ("+group.length+") != x.length ("+x.length+")")}pointcolor=pointcolor!=null?pointcolor:selectGroupColors(ngroup,"dark");pointcolor=expand2vector(pointcolor,ngroup);if(pointcolor.length!==ngroup){displayError("pointcolor.length ("+pointcolor.length+") != ngroup ("+ngroup+")")}if(x.every(function(v){return v!=null&&!xNA.force})){xNA.handle=false}if(y.every(function(v){return v!=null&&!yNA.force})){yNA.handle=false}if(xNA.handle){paneloffset=xNA.width+xNA.gap;panelwidth=width-paneloffset}else{paneloffset=0;panelwidth=width}if(yNA.handle){panelheight=height-(yNA.width+yNA.gap)}else{panelheight=height}xlim=xlim!=null?xlim:d3.extent(x);ylim=ylim!=null?ylim:d3.extent(y);na_value=d3.min(x.concat(y))-100;svg=d3.select(this).selectAll("svg").data([data]);gEnter=svg.enter().append("svg").attr("class","d3panels").append("g");svg.attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom);g=svg.select("g");g.append("rect").attr("x",paneloffset+margin.left).attr("y",margin.top).attr("height",panelheight).attr("width",panelwidth).attr("fill",rectcolor).attr("stroke","none");if(xNA.handle){g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",panelheight).attr("width",xNA.width).attr("fill",rectcolor).attr("stroke","none")}if(xNA.handle&&yNA.handle){g.append("rect").attr("x",margin.left).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",xNA.width).attr("fill",rectcolor).attr("stroke","none")}if(yNA.handle){g.append("rect").attr("x",margin.left+paneloffset).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",panelwidth).attr("fill",rectcolor).attr("stroke","none")}xrange=[margin.left+paneloffset+margin.inner,margin.left+paneloffset+panelwidth-margin.inner];yrange=[margin.top+panelheight-margin.inner,margin.top+margin.inner];xscale.domain(xlim).range(xrange);yscale.domain(ylim).range(yrange);xs=d3.scale.linear().domain(xlim).range(xrange);ys=d3.scale.linear().domain(ylim).range(yrange);if(xNA.handle){xscale.domain([na_value].concat(xlim)).range([margin.left+xNA.width/2].concat(xrange));x=x.map(function(e){if(e!=null){return e}else{return na_value}})}if(yNA.handle){yscale.domain([na_value].concat(ylim)).range([height+margin.top-yNA.width/2].concat(yrange));y=y.map(function(e){if(e!=null){return e}else{return na_value}})}yticks=yticks!=null?yticks:ys.ticks(nyticks);xticks=xticks!=null?xticks:xs.ticks(nxticks);titlegrp=g.append("g").attr("class","title").append("text").attr("x",margin.left+width/2).attr("y",margin.top-titlepos).text(title);xaxis=g.append("g").attr("class","x axis");xaxis.selectAll("empty").data(xticks).enter().append("line").attr("x1",function(d){return xscale(d)}).attr("x2",function(d){return xscale(d)}).attr("y1",margin.top).attr("y2",margin.top+height).attr("fill","none").attr("stroke","white").attr("stroke-width",1).style("pointer-events","none");xaxis.selectAll("empty").data(xticks).enter().append("text").attr("x",function(d){return xscale(d)}).attr("y",margin.top+height+axispos.xlabel).text(function(d){return formatAxis(xticks)(d)});xaxis.append("text").attr("class","title").attr("x",margin.left+width/2).attr("y",margin.top+height+axispos.xtitle).text(xlab);if(xNA.handle){xaxis.append("text").attr("x",margin.left+xNA.width/2).attr("y",margin.top+height+axispos.xlabel).text("N/A")}rotate_ylab=rotate_ylab!=null?rotate_ylab:ylab.length>1;yaxis=g.append("g").attr("class","y axis");yaxis.selectAll("empty").data(yticks).enter().append("line").attr("y1",function(d){return yscale(d)}).attr("y2",function(d){return yscale(d)}).attr("x1",margin.left).attr("x2",margin.left+width).attr("fill","none").attr("stroke","white").attr("stroke-width",1).style("pointer-events","none");yaxis.selectAll("empty").data(yticks).enter().append("text").attr("y",function(d){return yscale(d)}).attr("x",margin.left-axispos.ylabel).text(function(d){return formatAxis(yticks)(d)});yaxis.append("text").attr("class","title").attr("y",margin.top+height/2).attr("x",margin.left-axispos.ytitle).text(ylab).attr("transform",rotate_ylab?"rotate(270,"+(margin.left-axispos.ytitle)+","+(margin.top+height/2)+")":"");if(yNA.handle){yaxis.append("text").attr("x",margin.left-axispos.ylabel).attr("y",margin.top+height-yNA.width/2).text("N/A")}indtip=d3.tip().attr("class","d3-tip "+tipclass).html(function(d,i){return indID[i]}).direction("e").offset([0,10]);svg.call(indtip);points=g.append("g").attr("id","points");pointsSelect=points.selectAll("empty").data(d3.range(x.length)).enter().append("circle").attr("cx",function(d,i){return xscale(x[i])}).attr("cy",function(d,i){return yscale(y[i])}).attr("class",function(d,i){return"pt"+i}).attr("r",pointsize).attr("fill",function(d,i){return pointcolor[group[i]]}).attr("stroke",pointstroke).attr("stroke-width","1").attr("opacity",function(d,i){if((x[i]!=null||xNA.handle)&&(y[i]!=null||yNA.handle)){return 1}return 0}).on("mouseover.paneltip",indtip.show).on("mouseout.paneltip",indtip.hide);g.append("rect").attr("x",margin.left+paneloffset).attr("y",margin.top).attr("height",panelheight).attr("width",panelwidth).attr("fill","none").attr("stroke","black").attr("stroke-width","none");if(xNA.handle){g.append("rect").attr("x",margin.left).attr("y",margin.top).attr("height",panelheight).attr("width",xNA.width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")}if(xNA.handle&&yNA.handle){g.append("rect").attr("x",margin.left).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",xNA.width).attr("fill","none").attr("stroke","black").attr("stroke-width","none")}if(yNA.handle){return g.append("rect").attr("x",margin.left+paneloffset).attr("y",margin.top+height-yNA.width).attr("height",yNA.width).attr("width",panelwidth).attr("fill","none").attr("stroke","black").attr("stroke-width","none")}})};chart.width=function(value){if(!arguments.length){return width}width=value;return chart};chart.height=function(value){if(!arguments.length){return height}height=value;return chart};chart.margin=function(value){if(!arguments.length){return margin}margin=value;return chart};chart.axispos=function(value){if(!arguments.length){return axispos}axispos=value;return chart};chart.titlepos=function(value){if(!arguments.length){return titlepos}titlepos=value;return chart};chart.xlim=function(value){if(!arguments.length){return xlim}xlim=value;return chart};chart.nxticks=function(value){if(!arguments.length){return nxticks}nxticks=value;return chart};chart.xticks=function(value){if(!arguments.length){return xticks}xticks=value;return chart};chart.ylim=function(value){if(!arguments.length){return ylim}ylim=value;return chart};chart.nyticks=function(value){if(!arguments.length){return nyticks}nyticks=value;return chart};chart.yticks=function(value){if(!arguments.length){return yticks}yticks=value;return chart};chart.rectcolor=function(value){if(!arguments.length){return rectcolor}rectcolor=value;return chart};chart.pointcolor=function(value){if(!arguments.length){return pointcolor}pointcolor=value;return chart};chart.pointsize=function(value){if(!arguments.length){return pointsize}pointsize=value;return chart};chart.pointstroke=function(value){if(!arguments.length){return pointstroke}pointstroke=value;return chart};chart.dataByInd=function(value){if(!arguments.length){return dataByInd}dataByInd=value;return chart};chart.title=function(value){if(!arguments.length){return title}title=value;return chart};chart.xlab=function(value){if(!arguments.length){return xlab}xlab=value;return chart};chart.ylab=function(value){if(!arguments.length){return ylab}ylab=value;return chart};chart.rotate_ylab=function(value){if(!arguments.length){return rotate_ylab}rotate_ylab=value;return chart};chart.xvar=function(value){if(!arguments.length){return xvar}xvar=value;return chart};chart.yvar=function(value){if(!arguments.length){return yvar}yvar=value;return chart};chart.xNA=function(value){if(!arguments.length){return xNA}xNA=value;return chart};chart.yNA=function(value){if(!arguments.length){return yNA}yNA=value;return chart};chart.tipclass=function(value){if(!arguments.length){return tipclass}tipclass=value;return chart};chart.yscale=function(){return yscale};chart.xscale=function(){return xscale};chart.pointsSelect=function(){return pointsSelect};chart.remove=function(){svg.remove();indtip.destroy();return null};return chart};